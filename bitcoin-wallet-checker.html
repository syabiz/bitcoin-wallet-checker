<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin wallet.dat Password Checker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Sora:wght@300;400;600;700&display=swap');

        :root {
            --bg: #0a0e17;
            --surface: #111827;
            --surface2: #1a2235;
            --border: #1f2d42;
            --accent: #f7931a;
            --accent2: #ffb347;
            --text: #e2e8f0;
            --muted: #64748b;
            --success: #10b981;
            --error: #ef4444;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Sora', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--sans);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(247,147,26,0.12) 0%, transparent 60%),
                radial-gradient(ellipse 50% 40% at 80% 80%, rgba(247,147,26,0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 780px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .btc-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: #000;
            font-family: var(--mono);
            box-shadow: 0 0 30px rgba(247,147,26,0.4);
        }

        h1 {
            font-size: 1.9rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--muted);
            font-size: 0.9rem;
            font-weight: 300;
            margin-top: 6px;
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(247,147,26,0.5), transparent);
        }

        .info-box {
            background: rgba(247,147,26,0.07);
            border: 1px solid rgba(247,147,26,0.2);
            border-radius: 10px;
            padding: 14px 18px;
            margin-bottom: 28px;
            font-size: 0.85rem;
            color: #c4a46b;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .info-box .icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }

        .form-group { margin-bottom: 22px; }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.82rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
        }

        label span {
            color: var(--accent);
            text-transform: none;
            letter-spacing: 0;
            font-weight: 400;
            font-size: 0.8rem;
        }

        textarea, input[type="text"], input[type="password"] {
            width: 100%;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 16px;
            font-family: var(--mono);
            font-size: 0.82rem;
            color: var(--text);
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
            resize: vertical;
        }

        textarea:focus, input:focus {
            border-color: rgba(247,147,26,0.5);
            box-shadow: 0 0 0 3px rgba(247,147,26,0.08);
        }

        textarea { font-size: 0.78rem; line-height: 1.6; }

        .pw-wrap { position: relative; }
        .pw-wrap input { padding-right: 48px; }
        .toggle-pw {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--muted);
            font-size: 1.1rem;
            padding: 4px;
            transition: color 0.2s;
            width: auto;
        }
        .toggle-pw:hover { color: var(--accent); }

        .btn-check {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
            color: #000;
            font-family: var(--sans);
            font-size: 0.95rem;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            transition: opacity 0.2s, transform 0.15s, box-shadow 0.2s;
            box-shadow: 0 4px 24px rgba(247,147,26,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-check:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(247,147,26,0.45);
        }

        .btn-check:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spinner {
            width: 18px; height: 18px;
            border: 2px solid rgba(0,0,0,0.3);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Result */
        .result {
            display: none;
            border-radius: 14px;
            padding: 24px 28px;
            border: 1px solid;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .result.success {
            background: rgba(16,185,129,0.08);
            border-color: rgba(16,185,129,0.3);
        }
        .result.error {
            background: rgba(239,68,68,0.08);
            border-color: rgba(239,68,68,0.3);
        }
        .result.warning {
            background: rgba(247,147,26,0.08);
            border-color: rgba(247,147,26,0.3);
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .result.success .result-title { color: var(--success); }
        .result.error .result-title { color: var(--error); }
        .result.warning .result-title { color: var(--accent); }

        .result-msg {
            font-size: 0.88rem;
            color: var(--muted);
            line-height: 1.6;
        }

        /* Debug */
        .debug-toggle {
            background: none;
            border: 1px solid var(--border);
            color: var(--muted);
            border-radius: 6px;
            padding: 6px 14px;
            font-family: var(--sans);
            font-size: 0.78rem;
            cursor: pointer;
            margin-top: 16px;
            transition: border-color 0.2s, color 0.2s;
            width: auto;
        }
        .debug-toggle:hover { border-color: var(--accent); color: var(--accent); }

        .debug-panel {
            display: none;
            margin-top: 14px;
            background: #070c14;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 18px;
            font-family: var(--mono);
            font-size: 0.75rem;
            line-height: 1.8;
            color: #7dd3fc;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .debug-panel .label { color: var(--muted); }
        .debug-panel .val-ok { color: var(--success); }
        .debug-panel .val-err { color: var(--error); }
        .debug-panel .separator { color: var(--border); }

        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--muted);
            font-size: 0.78rem;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo">
            <div class="btc-icon">â‚¿</div>
            <h1>Wallet.dat Checker</h1>
        </div>
        <p class="subtitle">Bitcoin &amp; Litecoin Â· HashCat Format Â· SHA-512 + AES-256-CBC</p>
    </header>

    <div class="card">
        <div class="info-box">
            <span class="icon">â„¹ï¸</span>
            <span>Masukkan hash dalam format HashCat <code>$bitcoin$...</code> dan password yang ingin diperiksa. Proses dilakukan sepenuhnya di browser (client-side).</span>
        </div>

        <div class="form-group">
            <label for="bitcoinHash">Hash (HashCat format) <span>â€” $bitcoin$ atau $litecoin$</span></label>
            <textarea id="bitcoinHash" rows="4" placeholder="$bitcoin$64$..."></textarea>
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <div class="pw-wrap">
                <input type="password" id="password" placeholder="Masukkan password..." autocomplete="off">
                <button class="toggle-pw" onclick="togglePw()" title="Toggle visibility">ğŸ‘</button>
            </div>
        </div>

        <button class="btn-check" id="checkBtn" onclick="verify()">
            <div class="spinner" id="spinner"></div>
            <span id="btnText">ğŸ” Periksa Password</span>
        </button>
    </div>

    <div id="result" class="result">
        <div class="result-title" id="resultTitle"></div>
        <div class="result-msg" id="resultMessage"></div>
        <button class="debug-toggle" onclick="toggleDebug()" id="debugToggle" style="display:none">â–¶ Tampilkan Debug Info</button>
        <pre class="debug-panel" id="debugPanel"></pre>
    </div>

    <footer>Semua proses berjalan di browser Anda. Tidak ada data yang dikirim ke server.</footer>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Bitcoin wallet.dat Password Checker â€” Implementasi Benar
// KDF: SHA512 iteratif (Bitcoin Core crypter.cpp SetKeyFromPassphrase)
// Enkripsi: AES-256-CBC
// Validasi: PKCS7 padding check
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function hexToBytes(hex) {
    hex = hex.replace(/\s+/g, '');
    if (hex.length % 2 !== 0) throw new Error("Hex string harus panjang genap, dapat: " + hex.length);
    const bytes = new Uint8Array(hex.length / 2);
    for (let i = 0; i < bytes.length; i++)
        bytes[i] = parseInt(hex.substr(i * 2, 2), 16);
    return bytes;
}

function bytesToHex(bytes) {
    return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
}

function uint8ToWordArray(u8) {
    const words = [];
    for (let i = 0; i < u8.length; i += 4)
        words.push(((u8[i]||0)<<24)|((u8[i+1]||0)<<16)|((u8[i+2]||0)<<8)|(u8[i+3]||0));
    return CryptoJS.lib.WordArray.create(words, u8.length);
}

function wordArrayToUint8(wa) {
    const bytes = new Uint8Array(wa.sigBytes);
    for (let i = 0; i < wa.sigBytes; i++)
        bytes[i] = (wa.words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;
    return bytes;
}

// â”€â”€ Hash Parser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// Format bitcoin2john / hashcat -m 11300:
//   $bitcoin$<mkHexLen>$<mkHex>$<saltHexLen>$<saltHex>$<iterations>$...(extra fields)
//
// KUNCI PENTING â€” sering salah dipahami:
//   mkHexLen   = panjang STRING HEX, BUKAN byte count!
//                Jadi $bitcoin$64$... â†’ mkHex = 64 hex chars = 32 bytes
//   saltHexLen = panjang STRING HEX, BUKAN byte count!
//                Jadi $16$dff2b89e4d885c28$ â†’ saltHex = 16 hex chars = 8 bytes
//
// Contoh hash nyata dari wallet.dat:
//   $bitcoin$64$617c4b22fabd578e0f4d030245a0cbebd9da426fbee49c2feb885fa190b65096
//            $16$dff2b89e4d885c28$35714$2$00$2$00
//                                 â†‘ iterations

function parseBitcoinHash(hashStr) {
    hashStr = hashStr.trim();
    let prefix = '';
    if (hashStr.startsWith('$bitcoin$'))      prefix = '$bitcoin$';
    else if (hashStr.startsWith('$litecoin$')) prefix = '$litecoin$';
    else throw new Error('Format tidak valid. Hash harus diawali $bitcoin$ atau $litecoin$');

    const parts = hashStr.slice(prefix.length).split('$');

    if (parts.length < 5) throw new Error(
        `Hash tidak lengkap: hanya ${parts.length} bagian. Minimal 5 dibutuhkan.\n` +
        `Format: $bitcoin$<mkHexLen>$<mkHex>$<saltHexLen>$<saltHex>$<iterations>...`
    );

    const mkHexLen     = parseInt(parts[0]);  // panjang hex STRING (bukan bytes!)
    const masterKeyHex = parts[1];
    const saltHexLen   = parseInt(parts[2]);  // panjang hex STRING (bukan bytes!)
    const saltHex      = parts[3];
    const iterations   = parseInt(parts[4]);

    if (isNaN(mkHexLen) || isNaN(saltHexLen) || isNaN(iterations))
        throw new Error('Nilai numerik tidak valid di hash (mkHexLen/saltHexLen/iterations).');

    // mkHexLen adalah panjang hex chars yang diharapkan (BUKAN mkHexLen*2!)
    if (masterKeyHex.length !== mkHexLen) throw new Error(
        `Panjang mkHex tidak sesuai.\n` +
        `  Diharapkan : ${mkHexLen} hex chars (field pertama)\n` +
        `  Ditemukan  : ${masterKeyHex.length} hex chars\n\n` +
        `Tip: Pastikan hash lengkap dan tidak terpotong.`
    );

    if (saltHex.length !== saltHexLen) throw new Error(
        `Panjang saltHex tidak sesuai.\n` +
        `  Diharapkan : ${saltHexLen} hex chars\n` +
        `  Ditemukan  : ${saltHex.length} hex chars`
    );

    if (masterKeyHex.length < 64) throw new Error(
        `mkHex terlalu pendek (${masterKeyHex.length} chars).\n` +
        `Minimal 64 hex chars (32 bytes) untuk AES-256.`
    );

    if (iterations < 1 || iterations > 50000000)
        throw new Error(`Nilai iterations tidak wajar: ${iterations}`);

    return { masterKeyHex, saltHex, iterations };
}

// â”€â”€ KDF: Bitcoin Core SHA512 Stretching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// Referensi: src/wallet/crypter.cpp â€” CCrypter::SetKeyFromPassphrase()
// Bitcoin Core (nDerivationMethod == 0) menggunakan SHA512 iteratif:
//
//   data  = passphrase_bytes + salt_bytes
//   hash  = SHA512(data)          // round pertama
//   for i in range(1, nIterations):
//       hash = SHA512(hash)       // round ke-2 dst (tanpa pass+salt!)
//
//   key = hash[0..31]   (32 bytes)
//   iv  = hash[32..47]  (16 bytes)
//
// CATATAN: Round pertama concat pass+salt, round berikutnya hanya hash sebelumnya.
// Ini berbeda dari PBKDF2. Ini adalah "OpenSSL-style stretching" sederhana.

async function deriveKeyBitcoinSHA512(password, saltBytes, iterations) {
    const passBytes  = new TextEncoder().encode(password);
    const combined   = new Uint8Array(passBytes.length + saltBytes.length);
    combined.set(passBytes, 0);
    combined.set(saltBytes, passBytes.length);

    // Round 1: SHA512(pass + salt)
    let hashBuf = await crypto.subtle.digest('SHA-512', combined);

    // Round 2..N: SHA512(prev_hash) â€” tanpa pass+salt
    for (let i = 1; i < iterations; i++) {
        hashBuf = await crypto.subtle.digest('SHA-512', hashBuf);
    }

    return new Uint8Array(hashBuf); // 64 bytes: key=0..31, iv=32..47
}

// â”€â”€ Core Verification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function verify() {
    const hashStr  = document.getElementById('bitcoinHash').value.trim();
    const password = document.getElementById('password').value;

    const resultDiv   = document.getElementById('result');
    const resultTitle = document.getElementById('resultTitle');
    const resultMsg   = document.getElementById('resultMessage');
    const debugPanel  = document.getElementById('debugPanel');
    const debugToggle = document.getElementById('debugToggle');
    const spinner     = document.getElementById('spinner');
    const btnText     = document.getElementById('btnText');
    const checkBtn    = document.getElementById('checkBtn');

    resultDiv.style.display  = 'none';
    resultDiv.className      = 'result';
    debugPanel.style.display = 'none';
    debugToggle.style.display = 'none';
    debugPanel.textContent   = '';

    if (!hashStr)  { showResult('warning', 'âš ï¸ Hash Kosong',     'Masukkan hash terlebih dahulu.'); return; }
    if (!password) { showResult('warning', 'âš ï¸ Password Kosong', 'Masukkan password terlebih dahulu.'); return; }

    spinner.style.display = 'block';
    btnText.textContent   = 'Memproses...';
    checkBtn.disabled     = true;
    await new Promise(r => setTimeout(r, 30));

    const dbg = [];

    try {
        const parsed = parseBitcoinHash(hashStr);

        const saltBytes      = hexToBytes(parsed.saltHex);
        const masterKeyBytes = hexToBytes(parsed.masterKeyHex);
        const iterations     = parsed.iterations;

        dbg.push(`KDF               : SHA-512 iteratif (Bitcoin Core)`);
        dbg.push(`Password          : ${password}`);
        dbg.push(`Salt              : ${parsed.saltHex} (${saltBytes.length} bytes)`);
        dbg.push(`Iterations        : ${iterations}`);
        dbg.push(`MasterKey (hex)   : ${parsed.masterKeyHex} (${masterKeyBytes.length} bytes)`);
        dbg.push(`â”€`.repeat(60));

        const t0      = performance.now();
        const derived = await deriveKeyBitcoinSHA512(password, saltBytes, iterations);
        const elapsed = ((performance.now() - t0) / 1000).toFixed(3);

        const key = derived.slice(0, 32);
        const iv  = derived.slice(32, 48);

        dbg.push(`Waktu KDF         : ${elapsed}s`);
        dbg.push(`Key (32b)         : ${bytesToHex(key)}`);
        dbg.push(`IV  (16b)         : ${bytesToHex(iv)}`);
        dbg.push(`â”€`.repeat(60));

        // Ciphertext = 32 bytes pertama dari masterKeyHex
        // (bitcoin2john mengambil 2 AES block terakhir dari mkey terenkripsi)
        const cipherBytes = masterKeyBytes.slice(0, 32);
        dbg.push(`Ciphertext (32b)  : ${bytesToHex(cipherBytes)}`);

        const decrypted      = CryptoJS.AES.decrypt(
            { ciphertext: uint8ToWordArray(cipherBytes) },
            uint8ToWordArray(key),
            { iv: uint8ToWordArray(iv), mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.NoPadding }
        );
        const decryptedBytes = wordArrayToUint8(decrypted);
        dbg.push(`Decrypted (hex)   : ${bytesToHex(decryptedBytes)}`);

        // PKCS7 padding check: byte terakhir N, dan N byte terakhir semua = N
        const last    = decryptedBytes[decryptedBytes.length - 1];
        let isValid   = (last >= 1 && last <= 16);
        if (isValid) {
            for (let i = decryptedBytes.length - last; i < decryptedBytes.length; i++) {
                if (decryptedBytes[i] !== last) { isValid = false; break; }
            }
        }

        dbg.push(`Padding byte      : 0x${last.toString(16).padStart(2,'0')} (${last})`);
        dbg.push(`Padding valid     : ${isValid ? 'âœ“ YA â€” PASSWORD BENAR!' : 'âœ— TIDAK â€” Password salah'}`);

        debugPanel.textContent = dbg.join('\n');
        debugToggle.style.display = 'inline-block';

        if (isValid) {
            showResult('success', 'âœ… Password Benar!', `"${password}" cocok dengan hash ini.`);
        } else {
            showResult('error', 'âŒ Password Salah', 'Padding PKCS7 tidak valid. Password tidak cocok.');
        }

    } catch (err) {
        dbg.push(`\nError: ${err.message}`);
        debugPanel.textContent = dbg.join('\n');
        debugToggle.style.display = 'inline-block';
        showResult('warning', 'âš ï¸ Error', err.message);
    } finally {
        spinner.style.display = 'none';
        btnText.textContent   = 'ğŸ” Periksa Password';
        checkBtn.disabled     = false;
    }

    function showResult(type, title, msg) {
        resultDiv.className      = `result ${type}`;
        resultDiv.style.display  = 'block';
        resultTitle.textContent  = title;
        resultMsg.textContent    = msg;
    }
}

// â”€â”€ UI Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function togglePw() {
    const inp = document.getElementById('password');
    inp.type  = inp.type === 'password' ? 'text' : 'password';
}

function toggleDebug() {
    const panel  = document.getElementById('debugPanel');
    const toggle = document.getElementById('debugToggle');
    const show   = panel.style.display !== 'block';
    panel.style.display = show ? 'block' : 'none';
    toggle.textContent  = show ? 'â–¼ Sembunyikan Debug' : 'â–¶ Tampilkan Debug Info';
}

document.addEventListener('keydown', e => { if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) verify(); });
</script>
</body>
</html>
